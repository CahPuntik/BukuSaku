<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Buku Saku</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fda085">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Buku Saku">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="description" content="PWA untuk manajemen aktivitas harian dan timeframe pelatihan">
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js';
      import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js';
      import { getAuth } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js';
      
      const firebaseConfig = {
        apiKey: "AIzaSyCCBwvqjaG_M0a7308ZfDDJb7Mm3LjHxeI",
        authDomain: "buku-saku-instruktur.firebaseapp.com",
        projectId: "buku-saku-instruktur",
        storageBucket: "buku-saku-instruktur.firebasestorage.app",
        messagingSenderId: "180222950163",
        appId: "1:180222950163:web:3331e9673249098aa038e6"
      };
      
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      
      // Make Firebase available globally
      window.firebase = { app, db, auth };
    </script>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
      body {
        background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .login-container {
        max-width: 420px;
        width: 92%;
        margin: 36px auto;
        padding: 36px 32px 28px 32px;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.12);
        position: relative;
        overflow: hidden;
        text-align: center;
      }
      .avatar {
        width: 54px;
        height: 54px;
        border-radius: 50%;
        background: linear-gradient(135deg, #fda085 60%, #f6d365 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.2rem;
        color: #fff;
        margin: 0 auto 12px auto;
        box-shadow: 0 2px 8px rgba(253,160,133,0.18);
      }
      .login-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #f76b1c;
        letter-spacing: 1px;
        margin-bottom: 18px;
      }
      .login-logo {
        width: 180px;
        margin-bottom: 10px;
      }
      .form-floating .form-control, .form-floating .form-label {
        border-radius: 8px;
      }
      .btn-login {
        background: linear-gradient(90deg, #f76b1c 60%, #fda085 100%);
        border: none;
        color: #fff;
        font-weight: 600;
        padding: 10px 0;
        border-radius: 8px;
        margin-top: 18px;
        box-shadow: 0 2px 8px rgba(253,160,133,0.13);
        transition: background 0.18s, box-shadow 0.18s;
      }
      .btn-login:hover {
        background: linear-gradient(90deg, #fda085 0%, #f76b1c 100%);
        color: #fff;
      }
      #togglePassword {
        cursor: pointer;
        user-select: none;
      }
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }
        .login-container {
          padding: 20px 16px;
          max-width: 100%;
          width: 100%;
          margin: 10px auto;
        }
        .login-logo {
          width: 120px;
        }
        .login-title {
          font-size: 1.1rem;
        }
      }
      @media (max-width: 480px) {
        .login-container {
          padding: 18px 12px;
          margin: 5px auto;
        }
        .login-logo {
          width: 100px;
        }
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="avatar mb-2">üîí</div>
      <img src="Alamtri_logo.png" alt="Logo" class="login-logo">
      <div class="login-title">Login dulu Pelatih !!!</div>
      <form id="loginForm" autocomplete="off">
        <div class="form-floating mb-2">
          <input type="text" class="form-control" id="username" placeholder="Username" required>
          <label for="username">Username</label>
        </div>
        <div class="form-floating position-relative">
          <input type="password" class="form-control" id="password" placeholder="Password" required>
          <label for="password">Password</label>
          <span class="position-absolute top-50 end-0 translate-middle-y me-3" id="togglePassword" title="Tampilkan Password">üëÅÔ∏è</span>
        </div>
        <button class="w-100 btn btn-lg btn-login" type="submit" id="loginButton">Login</button>
      </form>
      <div id="status" class="mt-3"></div>
    </div>

    <script>
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyCbEPQIcaKgBU-jQbmSeC_1R1tXh1Y3hA7d3q8VMCr46qtpm6lanKbrebZ-1OD2Q7h/exec";

      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const loginButton = document.getElementById('loginButton');
        const statusDiv = document.getElementById('status');

        loginButton.disabled = true;
        loginButton.innerText = 'Memverifikasi...';
        statusDiv.innerHTML = '';

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
          const params = new URLSearchParams({ username, password }).toString();
          const response = await fetch(`${WEB_APP_URL}?${params}`);
          const result = await response.json();

          if (result.success) {
            // Simpan info user ke localStorage
            localStorage.setItem('bukuSakuUser', JSON.stringify({
              username: result.user,
              nama: result.nama || result.user, // gunakan result.nama jika ada
              role: result.role || ""
            }));
            statusDiv.innerHTML = `<div class="alert alert-success">
                ${result.message}<br>
                Waktu: ${result.time}
              </div>`;
            window.location.href = "dashboard.html";
          } else {
            statusDiv.innerHTML = `<div class="alert alert-danger">${result.message}</div>`;
          }
        } catch (err) {
          statusDiv.innerHTML = `<div class="alert alert-danger">Error: ${err.message}</div>`;
        }

        loginButton.disabled = false;
        loginButton.innerText = 'Login';
      });

      // fitur tampilkan/sembunyikan password
      const togglePassword = document.getElementById("togglePassword");
      const passwordInput = document.getElementById("password");

      togglePassword.addEventListener("click", () => {
        const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
        passwordInput.setAttribute("type", type);
        togglePassword.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
      });
    </script>
    <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('service-worker.js');
  });
}
</script>
  </body>
</html>