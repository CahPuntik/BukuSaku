<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Buku Saku (Local)</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fda085">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Buku Saku">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="description" content="PWA untuk manajemen aktivitas harian dan timeframe pelatihan">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
      body {
        background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      
      .auth-container {
        max-width: 400px;
        width: 90%;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        overflow: hidden;
      }
      
      .auth-header {
        background: linear-gradient(135deg, #f76b1c 0%, #fda085 100%);
        color: white;
        padding: 30px 20px;
        text-align: center;
      }
      
      .auth-header h2 {
        margin: 0;
        font-weight: 700;
        font-size: 1.8rem;
      }
      
      .auth-header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 0.9rem;
      }
      
      .auth-body {
        padding: 30px;
      }
      
      .form-group {
        margin-bottom: 20px;
      }
      
      .form-label {
        font-weight: 600;
        color: #555;
        margin-bottom: 8px;
        display: block;
      }
      
      .form-control {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 12px 15px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
      
      .form-control:focus {
        border-color: #f76b1c;
        box-shadow: 0 0 0 0.2rem rgba(247, 107, 28, 0.25);
      }
      
      .password-wrapper {
        position: relative;
      }
      
      .password-wrapper .form-control {
        padding-right: 45px;
      }
      
      .password-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        font-size: 1.2rem;
        color: #6c757d;
        user-select: none;
        z-index: 10;
        padding: 5px;
        transition: color 0.3s ease;
      }
      
      .password-toggle:hover {
        color: #f76b1c;
      }
      
      .btn-auth {
        background: linear-gradient(135deg, #f76b1c 0%, #fda085 100%);
        border: none;
        color: white;
        padding: 12px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 1rem;
        width: 100%;
        transition: all 0.3s ease;
      }
      
      .btn-auth:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(247, 107, 28, 0.4);
        color: white;
      }
      
      .btn-auth:disabled {
        opacity: 0.7;
        transform: none;
      }
      
      .auth-toggle {
        text-align: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }
      
      .auth-toggle a {
        color: #f76b1c;
        text-decoration: none;
        font-weight: 600;
      }
      
      .auth-toggle a:hover {
        text-decoration: underline;
      }
      
      .error-message, .success-message {
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
        display: none;
      }
      
      .error-message {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      
      .success-message {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      
      .logo {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      
      .logo img {
        width: 70px;
        height: 70px;
        object-fit: contain;
        border-radius: 50%;
      }
    </style>
  </head>
  
  <body>
    <div class="auth-container">
      <div class="auth-header">
        <div class="logo">
          <img src="Alamtri_logo.png" alt="Alamtri Logo">
        </div>
        <h2>Buku Saku</h2>
        <p>LOGIN dulu Pelatih !!!!!</p>
      </div>
      
      <div class="auth-body">
        <!-- Login Form -->
        <div id="loginForm">
          <div id="error-message" class="error-message"></div>
          <div id="success-message" class="success-message"></div>
          
          <div class="form-group">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" placeholder="Masukkan email Anda" onkeypress="handleEnter(event, 'login')">
          </div>
          
          <div class="form-group">
            <label for="password" class="form-label">Password</label>
            <div class="password-wrapper">
              <input type="password" class="form-control" id="password" placeholder="Masukkan password Anda" onkeypress="handleEnter(event, 'login')">
              <span class="password-toggle" onclick="togglePassword('password', this)">üëÅÔ∏è</span>
            </div>
          </div>
          
          <button type="button" class="btn btn-auth" id="loginBtn" onclick="loginUser()">
            Login
          </button>
          
          <div class="auth-toggle">
            <p>Belum punya akun? <a href="#" onclick="showRegister()">Daftar di sini</a></p>
          </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerForm" style="display: none;">
          <div id="register-error-message" class="error-message"></div>
          <div id="register-success-message" class="success-message"></div>
          
          <div class="form-group">
            <label for="regName" class="form-label">Nama Lengkap</label>
            <input type="text" class="form-control" id="regName" placeholder="Masukkan nama lengkap" onkeypress="handleEnter(event, 'register')">
          </div>
          
          <div class="form-group">
            <label for="regEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="regEmail" placeholder="Masukkan email Anda" onkeypress="handleEnter(event, 'register')">
          </div>
          
          <div class="form-group">
            <label for="regPassword" class="form-label">Password</label>
            <div class="password-wrapper">
              <input type="password" class="form-control" id="regPassword" placeholder="Minimal 6 karakter" onkeypress="handleEnter(event, 'register')">
              <span class="password-toggle" onclick="togglePassword('regPassword', this)">üëÅÔ∏è</span>
            </div>
          </div>
          
          <div class="form-group">
            <label for="regConfirmPassword" class="form-label">Konfirmasi Password</label>
            <div class="password-wrapper">
              <input type="password" class="form-control" id="regConfirmPassword" placeholder="Ulangi password Anda" onkeypress="handleEnter(event, 'register')">
              <span class="password-toggle" onclick="togglePassword('regConfirmPassword', this)">üëÅÔ∏è</span>
            </div>
          </div>
          
          <button type="button" class="btn btn-auth" id="registerBtn" onclick="registerUser()">
            Daftar
          </button>
          
          <div class="auth-toggle">
            <p>Sudah punya akun? <a href="#" onclick="showLogin()">Login di sini</a></p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      // Local Storage Authentication (Fallback)
      
      // Check if user is already logged in
      window.addEventListener('load', function() {
        const user = JSON.parse(localStorage.getItem('bukuSakuUser') || 'null');
        if (user && user.email) {
          window.location.href = 'dashboard.html';
        }
      });
      
      // Login function (Local Storage)
      function loginUser() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('error-message');
        const loginBtn = document.getElementById('loginBtn');
        
        if (!email || !password) {
          showError('Silakan masukkan email dan password');
          return;
        }
        
        try {
          loginBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Logging in...';
          loginBtn.disabled = true;
          errorDiv.style.display = 'none';
          
          // Get stored users
          const users = JSON.parse(localStorage.getItem('bukuSakuUsers') || '[]');
          const user = users.find(u => u.email === email && u.password === password);
          
          if (user) {
            // Save user session
            const userData = {
              nama: user.nama,
              email: user.email,
              role: user.role || 'instruktur',
              uid: user.email // Use email as UID
            };
            
            localStorage.setItem('bukuSakuUser', JSON.stringify(userData));
            
            // Redirect to dashboard
            window.location.href = 'dashboard.html';
          } else {
            showError('Email atau password salah');
          }
          
        } catch (error) {
          console.error('Login error:', error);
          showError('Terjadi kesalahan saat login');
        } finally {
          loginBtn.innerHTML = 'Login';
          loginBtn.disabled = false;
        }
      }
      
      // Register function (Local Storage)
      function registerUser() {
        const name = document.getElementById('regName').value;
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const confirmPassword = document.getElementById('regConfirmPassword').value;
        const errorDiv = document.getElementById('register-error-message');
        const successDiv = document.getElementById('register-success-message');
        const registerBtn = document.getElementById('registerBtn');
        
        if (!name || !email || !password || !confirmPassword) {
          showRegisterError('Silakan isi semua field');
          return;
        }
        
        if (password !== confirmPassword) {
          showRegisterError('Password tidak sama');
          return;
        }
        
        if (password.length < 6) {
          showRegisterError('Password minimal 6 karakter');
          return;
        }
        
        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showRegisterError('Format email tidak valid');
          return;
        }
        
        try {
          registerBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating account...';
          registerBtn.disabled = true;
          errorDiv.style.display = 'none';
          successDiv.style.display = 'none';
          
          // Get existing users
          const users = JSON.parse(localStorage.getItem('bukuSakuUsers') || '[]');
          
          // Check if email already exists
          if (users.find(u => u.email === email)) {
            showRegisterError('Email sudah terdaftar');
            return;
          }
          
          // Create new user
          const newUser = {
            nama: name,
            email: email,
            password: password, // In real app, this should be hashed
            role: 'instruktur',
            createdAt: new Date().toISOString()
          };
          
          // Add to users array
          users.push(newUser);
          localStorage.setItem('bukuSakuUsers', JSON.stringify(users));
          
          // Show success message
          showRegisterSuccess('Akun berhasil dibuat! Silakan login.');
          
          // Auto switch to login form after 2 seconds
          setTimeout(() => {
            showLogin();
          }, 2000);
          
        } catch (error) {
          console.error('Register error:', error);
          showRegisterError('Terjadi kesalahan saat mendaftar');
        } finally {
          registerBtn.innerHTML = 'Daftar';
          registerBtn.disabled = false;
        }
      }
      
      function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
      }
      
      function showRegisterError(message) {
        const errorDiv = document.getElementById('register-error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
      }
      
      function showRegisterSuccess(message) {
        const successDiv = document.getElementById('register-success-message');
        successDiv.textContent = message;
        successDiv.style.display = 'block';
      }
      
      // Toggle between login and register forms
      function showRegister() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'block';
        // Clear messages
        document.getElementById('error-message').style.display = 'none';
      }
      
      function showLogin() {
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
        // Clear messages
        document.getElementById('register-error-message').style.display = 'none';
        document.getElementById('register-success-message').style.display = 'none';
      }
      
      // Enter key handler
      function handleEnter(event, action) {
        if (event.key === 'Enter') {
          if (action === 'login') {
            loginUser();
          } else if (action === 'register') {
            registerUser();
          }
        }
      }
      
      // Toggle password visibility
      function togglePassword(inputId, toggleElement) {
        const passwordInput = document.getElementById(inputId);
        const isPassword = passwordInput.type === 'password';
        
        // Toggle input type
        passwordInput.type = isPassword ? 'text' : 'password';
        
        // Toggle icon
        toggleElement.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
      }
      
      // Register Service Worker for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('service-worker.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful');
            })
            .catch(function(err) {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
    </script>
  </body>
</html>